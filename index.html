<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>ETH → USDC 报价测试</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body style="font-family:sans-serif;max-width:600px;margin:40px auto;">

  <h2>ETH → USDC 报价测试 (1inch)</h2>

  <button id="connectBtn">连接钱包</button>
  <p>钱包地址: <span id="address">未连接</span></p>

  <label>输入 ETH 数量：</label>
  <input type="number" id="ethAmount" placeholder="0.1" step="0.01">
  <button id="quoteBtn">获取报价</button>

  <h3>结果</h3>
  <p id="result">—</p>

<script>
let provider, signer, userAddress;

// 连接钱包
document。getElementById('connectBtn')。onclick = async () => {
  if (!window。ethereum) { alert("请安装 MetaMask"); return; }
  provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = provider.getSigner();
  userAddress = await signer.getAddress();
  document。getElementById('address')。textContent = userAddress;
};

// 获取报价
document。getElementById('quoteBtn')。onclick = async () => {
  const amountEth = document.getElementById('ethAmount').value;
  if (!amountEth || amountEth <= 0) { alert("请输入数量"); return; }

  // ETH → USDC (Ethereum 主网)
  const chainId = 1;
  const fromToken = "0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE"; // ETH
  const toToken   = "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"; // USDC
  const amountWei = ethers.utils.parseEther(amountEth.toString()).toString();

  const url = `https://api.1inch.io/v5.0/${chainId}/quote?fromTokenAddress=${fromToken}&toTokenAddress=${toToken}&amount=${amountWei}`;

  try {
    const res = await fetch(url);
    if (!res。ok) throw new 错误("请求失败: " + res。status);
    const data = await res.json();

    const usdcAmount = ethers.utils.formatUnits(data.toTokenAmount, 6); // USDC 6位小数
    document.getElementById('result').textContent = 
      `${amountEth} ETH ≈ ${usdcAmount} USDC`;
  } catch (e) {
    document。getElementById('result')。textContent = "错误: " + e.message;
  }
};
</script>
</body>
</html>
