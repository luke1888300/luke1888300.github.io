<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OKX DEX èšåˆäº¤æ˜“å¹³å°</title>
    <!-- å¼•å…¥å¿…è¦çš„åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <style>
        :root {
            --primary: #0e7bff;
            --primary-dark: #0a5fcc;
            --secondary: #f0f4ff;
            --text: #333;
            --text-light: #666;
            --border: #ddd;
            --background: #fff;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            max-width: 480px;
            width: 100%;
            background-color: var(--background);
            border-radius: 16px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid var(--border);
            background-color: var(--secondary);
            position: relative;
        }

        h1 {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .wallet-connect {
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .connect-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .connect-btn:hover {
            background: var(--primary-dark);
        }

        .wallet-info {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            border-radius: 20px;
            padding: 6px 12px;
            border: 1px solid var(--border);
        }

        .wallet-address {
            font-size: 0.8rem;
            font-weight: bold;
        }

        .wallet-balance {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .disconnect-btn {
            background: none;
            border: none;
            color: var(--error);
            cursor: pointer;
            font-size: 1.2rem;
        }

        .network-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .network-btn {
            padding: 8px 16px;
            border: 1px solid var(--border);
            border-radius: 20px;
            background: white;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .network-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .swap-container {
            padding: 20px;
        }

        .token-input {
            background-color: var(--secondary);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }

        .token-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .token-label {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .balance {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .amount-selector {
            margin: 10px 0;
        }

        .amount-options {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .amount-option {
            padding: 6px 10px;
            border: 1px solid var(--border);
            border-radius: 20px;
            background: white;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .amount-option:hover {
            border-color: var(--primary);
        }

        .token-selector {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .token-amount {
            font-size: 1.8rem;
            font-weight: bold;
            border: none;
            background: transparent;
            width: 70%;
            color: var(--text);
            outline: none;
        }

        .token-select {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }

        .token-select:hover {
            border-color: var(--primary);
        }

        .token-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: #ddd;
        }

        .token-symbol {
            font-weight: bold;
        }

        .switch-tokens {
            display: flex;
            justify-content: center;
            margin: 10px 0;
        }

        .switch-btn {
            background: white;
            border: 1px solid var(--border);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .switch-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .slippage-selector {
            margin: 20px 0;
        }

        .slippage-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .slippage-title span {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .slippage-options {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .slippage-option {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 20px;
            background: white;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .slippage-option.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .slippage-custom {
            width: 80px;
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 0.9rem;
            text-align: center;
        }

        .recipient-address {
            margin: 20px 0;
        }

        .recipient-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .recipient-label span {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .address-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 0.9rem;
        }

        .price-info {
            background-color: var(--secondary);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            font-size: 0.9rem;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .unit-price {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 8px;
        }

        .unit-price-value {
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }

        .unit-price-value:hover {
            color: var(--primary);
        }

        .refresh-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .refresh-interval {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .refresh-interval-label {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .refresh-interval-input {
            width: 80px;
            padding: 6px 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.8rem;
            text-align: center;
        }

        .refresh-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .refresh-btn:hover {
            background: var(--primary-dark);
        }

        .swap-btn {
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
        }

        .swap-btn:hover {
            background: var(--primary-dark);
        }

        .swap-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 400px;
            padding: 20px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }

        .wallet-list {
            list-style: none;
            margin-bottom: 20px;
        }

        .wallet-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .wallet-item:hover {
            border-color: var(--primary);
            background-color: var(--secondary);
        }

        .wallet-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .wallet-info-modal {
            flex: 1;
        }

        .wallet-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .wallet-desc {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .token-list {
            list-style: none;
        }

        .token-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s;
        }

        .token-item:hover {
            background: var(--secondary);
        }

        .token-info {
            flex: 1;
        }

        .token-name {
            font-weight: bold;
        }

        .token-contract {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .add-token-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .add-token-btn:hover {
            background: var(--primary-dark);
        }

        .custom-token-form {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .form-input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s;
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .notification.success {
            background: var(--success);
        }

        .notification.error {
            background: var(--error);
        }

        .decimals-toggle {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            color: var(--text-light);
            cursor: pointer;
            margin-left: 10px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .container {
                border-radius: 12px;
            }

            .swap-container {
                padding: 15px;
            }

            .token-amount {
                font-size: 1.5rem;
            }

            .slippage-options, .amount-options {
                gap: 5px;
            }

            .slippage-option, .amount-option {
                padding: 6px 10px;
                font-size: 0.8rem;
            }

            .refresh-controls {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }

            .refresh-interval {
                width: 100%;
                justify-content: space-between;
            }

            .wallet-connect {
                position: static;
                margin-bottom: 15px;
                display: flex;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>OKX DEX èšåˆäº¤æ˜“</h1>
            <div class="wallet-connect" id="walletConnect">
                <!-- é’±åŒ…è¿æ¥çŠ¶æ€å°†åŠ¨æ€æ˜¾ç¤º -->
            </div>
            <div class="network-selector">
                <button class="network-btn active" data-chain="1">ä»¥å¤ªåŠ</button>
                <button class="network-btn" data-chain="56">BSC</button>
            </div>
        </header>

        <div class="swap-container">
            <div class="token-input">
                <div class="token-header">
                    <span class="token-label">ä»</span>
                    <span class="balance">ä½™é¢: <span id="fromBalance">0.0</span></span>
                </div>
                
                <div class="amount-selector">
                    <div class="amount-options">
                        <div class="amount-option" data-amount="500">500</div>
                        <div class="amount-option" data-amount="1000">1K</div>
                        <div class="amount-option" data-amount="2000">2K</div>
                        <div class="amount-option" data-amount="5000">5K</div>
                        <div class="amount-option" data-amount="10000">10K</div>
                        <div class="amount-option" data-percentage="25">25%</div>
                        <div class="amount-option" data-percentage="50">50%</div>
                        <div class="amount-option" data-percentage="75">75%</div>
                        <div class="amount-option" data-percentage="100">MAX</div>
                    </div>
                </div>
                
                <div class="token-selector">
                    <input type="text" class="token-amount" id="fromAmount" placeholder="0.0" value="1">
                    <div class="token-select" id="fromTokenSelect">
                        <div class="token-icon"></div>
                        <span class="token-symbol">ETH</span>
                        <span>â–¼</span>
                    </div>
                </div>
            </div>

            <div class="switch-tokens">
                <button class="switch-btn" id="switchTokens">â‡…</button>
            </div>

            <div class="token-input">
                <div class="token-header">
                    <span class="token-label">åˆ°</span>
                    <span class="balance">ä½™é¢: <span id="toBalance">0.0</span></span>
                </div>
                <div class="token-selector">
                    <input type="text" class="token-amount" id="toAmount" placeholder="0.0" readonly>
                    <div class="token-select" id="toTokenSelect">
                        <div class="token-icon"></div>
                        <span class="token-symbol">USDT</span>
                        <span>â–¼</span>
                    </div>
                </div>
            </div>

            <div class="slippage-selector">
                <div class="slippage-title">
                    <span>æ»‘ç‚¹å®¹å¿åº¦</span>
                </div>
                <div class="slippage-options">
                    <div class="slippage-option active" data-slippage="auto">è‡ªåŠ¨</div>
                    <div class="slippage-option" data-slippage="0.1">0.1%</div>
                    <div class="slippage-option" data-slippage="0.5">0.5%</div>
                    <div class="slippage-option" data-slippage="4">4%</div>
                    <input type="text" class="slippage-custom" placeholder="è‡ªå®šä¹‰" id="customSlippage">
                </div>
            </div>

            <div class="recipient-address">
                <div class="recipient-label">
                    <span>æ”¶æ¬¾åœ°å€ (å¯é€‰)</span>
                </div>
                <input type="text" class="address-input" id="recipientAddress" placeholder="è¾“å…¥æ”¶æ¬¾åœ°å€ (é»˜è®¤å½“å‰åœ°å€)">
            </div>

            <div class="price-info">
                <div class="price-row">
                    <span>å•ä»·</span>
                    <div style="display: flex; align-items: center;">
                        <span class="unit-price-value" id="unitPrice">1 ETH = 0 USDT</span>
                        <div class="decimals-toggle">
                            <input type="checkbox" id="toggleDecimals">
                            <label for="toggleDecimals">12ä½</label>
                        </div>
                    </div>
                </div>
                <div class="price-row">
                    <span>æœ€ä½æ”¶åˆ°</span>
                    <span id="minReceived">0.0 USDT</span>
                </div>
                <div class="price-row">
                    <span>ä»·æ ¼å½±å“</span>
                    <span id="priceImpact">0.00%</span>
                </div>
                <div class="price-row">
                    <span>è·¯ç”±</span>
                    <span id="route">è·å–ä¸­...</span>
                </div>
                <div class="refresh-controls">
                    <div class="refresh-interval">
                        <span class="refresh-interval-label">åˆ·æ–°é—´éš”:</span>
                        <input type="number" class="refresh-interval-input" id="refreshInterval" value="10000" min="5000" step="1000">
                        <span class="refresh-interval-label">ms</span>
                    </div>
                    <button class="refresh-btn" id="refreshPrice">
                        <span>åˆ·æ–°ä»·æ ¼</span>
                        <span>â†»</span>
                    </button>
                </div>
            </div>

            <button class="swap-btn" id="swapButton">äº¤æ¢</button>
        </div>
    </div>

    <!-- é’±åŒ…é€‰æ‹©æ¨¡æ€æ¡† -->
    <div class="modal" id="walletModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">é€‰æ‹©é’±åŒ…</div>
                <button class="close-modal">&times;</button>
            </div>
            <ul class="wallet-list" id="walletList">
                <li class="wallet-item" data-wallet="metamask">
                    <div class="wallet-icon">ğŸ¦Š</div>
                    <div class="wallet-info-modal">
                        <div class="wallet-name">MetaMask</div>
                        <div class="wallet-desc">ä½¿ç”¨MetaMaské’±åŒ…è¿æ¥</div>
                    </div>
                </li>
                <li class="wallet-item" data-wallet="walletconnect">
                    <div class="wallet-icon">âš¡</div>
                    <div class="wallet-info-modal">
                        <div class="wallet-name">WalletConnect</div>
                        <div class="wallet-desc">ä½¿ç”¨WalletConnectåè®®è¿æ¥</div>
                    </div>
                </li>
                <li class="wallet-item" data-wallet="coinbase">
                    <div class="wallet-icon">ğŸ”·</div>
                    <div class="wallet-info-modal">
                        <div class="wallet-name">Coinbase Wallet</div>
                        <div class="wallet-desc">ä½¿ç”¨Coinbaseé’±åŒ…è¿æ¥</div>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <!-- ä»£å¸é€‰æ‹©æ¨¡æ€æ¡† -->
    <div class="modal" id="tokenModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">é€‰æ‹©ä»£å¸</div>
                <button class="close-modal">&times;</button>
            </div>
            <ul class="token-list" id="tokenList">
                <!-- ä»£å¸åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </ul>
            <div class="custom-token-form">
                <div class="form-group">
                    <label class="form-label">ä»£å¸åˆçº¦åœ°å€</label>
                    <input type="text" class="form-input" id="tokenContract" placeholder="è¾“å…¥ä»£å¸åˆçº¦åœ°å€">
                </div>
                <button class="add-token-btn" id="addTokenBtn">æ·»åŠ ä»£å¸</button>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥ -->
    <div class="notification" id="notification"></div>

    <script>
        // çŠ¶æ€ç®¡ç†
        const state = {
            chainId: '1', // å½“å‰é“¾ID
            fromToken: {
                symbol: 'ETH',
                address: '0x0000000000000000000000000000000000000000',
                decimals: 18,
                balance: 0
            },
            toToken: {
                symbol: 'USDT',
                address: '0xdac17f958d2ee523a2206206994597c13d831ec7',
                decimals: 6,
                balance: 0
            },
            amount: 1,
            slippage: 'auto',
            recipientAddress: '',
            exchangeRate: 0,
            priceImpact: 0,
            route: '',
            highPrecision: false,
            priceDirection: 'forward',
            refreshInterval: 10000,
            refreshTimer: null,
            walletConnected: false,
            walletAddress: '',
            walletBalance: 0,
            provider: null,
            signer: null
        };

        // é“¾é…ç½®
        const CHAIN_CONFIG = {
            '1': {
                name: 'Ethereum',
                rpcUrl: 'https://mainnet.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161',
                explorer: 'https://etherscan.io',
                nativeCurrency: 'ETH'
            },
            '56': {
                name: 'BSC',
                rpcUrl: 'https://bsc-dataseed.binance.org/',
                explorer: 'https://bscscan.com',
                nativeCurrency: 'BNB'
            }
        };

        // å¸¸ç”¨ä»£å¸åˆ—è¡¨
        const TOKEN_LISTS = {
            '1': [
                { symbol: 'ETH', address: '0x0000000000000000000000000000000000000000', decimals: 18 },
                { symbol: 'USDT', address: '0xdac17f958d2ee523a2206206994597c13d831ec7', decimals: 6 },
                { symbol: 'USDC', address: '0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48', decimals: 6 },
                { symbol: 'DAI', address: '0x6b175474e89094c44da98b954eedeac495271d0f', decimals: 18 },
                { symbol: 'WBTC', address: '0x2260fac5e5542a773aa44fbcfedf7c193bc2c599', decimals: 8 }
            ],
            '56': [
                { symbol: 'BNB', address: '0x0000000000000000000000000000000000000000', decimals: 18 },
                { symbol: 'BUSD', address: '0xe9e7cea3dedca5984780bafc599bd69add087d56', decimals: 18 },
                { symbol: 'USDT', address: '0x55d398326f99059ff775485246999027b3197955', decimals: 18 },
                { symbol: 'USDC', address: '0x8ac76a51cc950d9822d68b83fe1ad97b32cd580d', decimals: 18 },
                { symbol: 'CAKE', address: '0x0e09fabb73bd3ade0a17ecc321fd13a19e81ce82', decimals: 18 }
            ]
        };

        // DOMå…ƒç´ 
        const elements = {
            walletConnect: document.getElementById('walletConnect'),
            walletModal: document.getElementById('walletModal'),
            walletList: document.getElementById('walletList'),
            networkBtns: document.querySelectorAll('.network-btn'),
            fromTokenSelect: document.getElementById('fromTokenSelect'),
            toTokenSelect: document.getElementById('toTokenSelect'),
            fromAmount: document.getElementById('fromAmount'),
            toAmount: document.getElementById('toAmount'),
            fromBalance: document.getElementById('fromBalance'),
            toBalance: document.getElementById('toBalance'),
            switchTokens: document.getElementById('switchTokens'),
            slippageOptions: document.querySelectorAll('.slippage-option'),
            customSlippage: document.getElementById('customSlippage'),
            amountOptions: document.querySelectorAll('.amount-option'),
            recipientAddress: document.getElementById('recipientAddress'),
            unitPrice: document.getElementById('unitPrice'),
            minReceived: document.getElementById('minReceived'),
            priceImpact: document.getElementById('priceImpact'),
            route: document.getElementById('route'),
            toggleDecimals: document.getElementById('toggleDecimals'),
            refreshInterval: document.getElementById('refreshInterval'),
            refreshPrice: document.getElementById('refreshPrice'),
            swapButton: document.getElementById('swapButton'),
            tokenModal: document.getElementById('tokenModal'),
            tokenList: document.getElementById('tokenList'),
            tokenContract: document.getElementById('tokenContract'),
            addTokenBtn: document.getElementById('addTokenBtn'),
            closeModal: document.querySelectorAll('.close-modal'),
            notification: document.getElementById('notification')
        };

        // åˆå§‹åŒ–
        async function init() {
            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            setupEventListeners();
            
            // åˆå§‹åŒ–æä¾›è€…ï¼ˆä½¿ç”¨å…¬å…±RPCèŠ‚ç‚¹ï¼‰
            await initProvider();
            
            // æ›´æ–°UI
            updateUI();
            
            // è·å–ä»·æ ¼ä¿¡æ¯
            await fetchPrice();
            
            // å¯åŠ¨è‡ªåŠ¨åˆ·æ–°
            startAutoRefresh();
            
            // æ›´æ–°é’±åŒ…è¿æ¥çŠ¶æ€
            updateWalletStatus();
        }

        // åˆå§‹åŒ–æä¾›è€…
        async function initProvider() {
            try {
                // ä½¿ç”¨å…¬å…±RPCèŠ‚ç‚¹
                const rpcUrl = CHAIN_CONFIG[state.chainId].rpcUrl;
                state.provider = new ethers.providers.JsonRpcProvider(rpcUrl);
                
                // æ£€æŸ¥æ˜¯å¦æœ‰å·²è¿æ¥çš„é’±åŒ…
                if (window.ethereum) {
                    await checkWalletConnection();
                }
            } catch (error) {
                console.error('åˆå§‹åŒ–æä¾›è€…å¤±è´¥:', error);
                showNotification('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®', 'error');
            }
        }

        // æ£€æŸ¥é’±åŒ…è¿æ¥çŠ¶æ€
        async function checkWalletConnection() {
            if (window.ethereum && window.ethereum.selectedAddress) {
                try {
                    state.provider = new ethers.providers.Web3Provider(window.ethereum);
                    state.signer = state.provider.getSigner();
                    state.walletAddress = await state.signer.getAddress();
                    state.walletConnected = true;
                    
                    // è·å–ä½™é¢
                    await updateWalletBalance();
                    
                    updateWalletStatus();
                } catch (error) {
                    console.error('æ£€æŸ¥é’±åŒ…è¿æ¥å¤±è´¥:', error);
                }
            }
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // é’±åŒ…è¿æ¥
            elements.walletConnect.addEventListener('click', openWalletModal);
            
            // é’±åŒ…é€‰æ‹©
            elements.walletList.querySelectorAll('.wallet-item').forEach(item => {
                item.addEventListener('click', () => {
                    const walletType = item.dataset.wallet;
                    connectWallet(walletType);
                });
            });

            // ç½‘ç»œåˆ‡æ¢
            elements.networkBtns.forEach(btn => {
                btn.addEventListener('click', async () => {
                    elements.networkBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    state.chainId = btn.dataset.chain;
                    
                    // é‡æ–°åˆå§‹åŒ–æä¾›è€…
                    await initProvider();
                    updateUI();
                    await fetchPrice();
                });
            });

            // å…¶ä»–äº‹ä»¶ç›‘å¬å™¨ä¿æŒä¸å˜...
            // [æ­¤å¤„çœç•¥å…¶ä»–äº‹ä»¶ç›‘å¬å™¨ä»£ç ï¼Œä¿æŒä¸ä¹‹å‰ç›¸åŒ]
        }

        // è¿æ¥é’±åŒ…
        async function connectWallet(walletType) {
            try {
                showNotification(`æ­£åœ¨è¿æ¥${getWalletName(walletType)}...`, 'success');
                
                if (walletType === 'metamask') {
                    await connectMetaMask();
                } else if (walletType === 'walletconnect') {
                    await connectWalletConnect();
                } else if (walletType === 'coinbase') {
                    await connectCoinbase();
                }
                
                elements.walletModal.style.display = 'none';
            } catch (error) {
                console.error('é’±åŒ…è¿æ¥å¤±è´¥:', error);
                showNotification('é’±åŒ…è¿æ¥å¤±è´¥: ' + error.message, 'error');
            }
        }

        // è¿æ¥MetaMask
        async function connectMetaMask() {
            if (!window.ethereum) {
                throw new Error('è¯·å®‰è£…MetaMaské’±åŒ…');
            }
            
            // è¯·æ±‚è´¦æˆ·è®¿é—®
            await window.ethereum.request({ method: 'eth_requestAccounts' });
            
            // åˆ›å»ºæä¾›è€…
            state.provider = new ethers.providers.Web3Provider(window.ethereum);
            state.signer = state.provider.getSigner();
            state.walletAddress = await state.signer.getAddress();
            state.walletConnected = true;
            
            // è·å–ä½™é¢
            await updateWalletBalance();
            
            updateWalletStatus();
            showNotification('MetaMaskè¿æ¥æˆåŠŸ', 'success');
            
            // ç›‘å¬è´¦æˆ·å˜åŒ–
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    disconnectWallet();
                } else {
                    state.walletAddress = accounts[0];
                    updateWalletBalance();
                    updateWalletStatus();
                }
            });
            
            // ç›‘å¬é“¾å˜åŒ–
            window.ethereum.on('chainChanged', (chainId) => {
                state.chainId = parseInt(chainId, 16).toString();
                updateNetworkUI();
                initProvider();
            });
        }

        // è¿æ¥WalletConnectï¼ˆç®€åŒ–å®ç°ï¼‰
        async function connectWalletConnect() {
            showNotification('WalletConnectåŠŸèƒ½éœ€è¦é¢å¤–é…ç½®', 'warning');
            // å®é™…å®ç°éœ€è¦é›†æˆWalletConnect SDK
        }

        // è¿æ¥Coinbaseé’±åŒ…ï¼ˆç®€åŒ–å®ç°ï¼‰
        async function connectCoinbase() {
            if (window.ethereum && window.ethereum.isCoinbaseWallet) {
                await connectMetaMask(); // Coinbaseé’±åŒ…ä¹Ÿæ”¯æŒEIP-1193
            } else {
                showNotification('è¯·å®‰è£…Coinbaseé’±åŒ…', 'warning');
            }
        }

        // è·å–ä»·æ ¼ä¿¡æ¯ï¼ˆä½¿ç”¨æ¨¡æ‹Ÿçš„APIè°ƒç”¨ï¼‰
        async function fetchPrice() {
            if (!state.fromToken || !state.toToken) return;
            
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                elements.swapButton.innerHTML = '<div class="loading"></div> è·å–ä»·æ ¼...';
                elements.swapButton.disabled = true;
                
                // æ¨¡æ‹ŸAPIè°ƒç”¨ - å®é™…åº”è¯¥è°ƒç”¨çœŸå®çš„DEXèšåˆå™¨API
                const fromSymbol = state.fromToken.symbol;
                const toSymbol = state.toToken.symbol;
                const amount = parseFloat(state.amount) || 0;
                
                // è¿™é‡Œåº”è¯¥æ˜¯çœŸå®çš„APIè°ƒç”¨
                // const response = await fetch(`https://web3.okx.com/api/v5/dex/aggregator/swap?from=${fromToken.address}&to=${toToken.address}&amount=${amount}`);
                // const data = await response.json();
                
                // æ¨¡æ‹Ÿæ•°æ®
                const mockPrice = fromSymbol === 'ETH' || fromSymbol === 'BNB' ? 
                    (Math.random() * 1000 + 2000) : (Math.random() * 0.1 + 0.0001);
                
                state.exchangeRate = mockPrice;
                state.priceImpact = (Mathã€‚random() * 2).toFixed(2);
                state.route = 'Uniswap V3';
                
                updatePriceInfo();
                
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                elements.swapButton.textContent = 'äº¤æ¢';
                elements.swapButton.disabled = !state.walletConnected;
                
            } catch (error) {
                consoleã€‚error('è·å–ä»·æ ¼å¤±è´¥:'ï¼Œ error);
                showNotification('è·å–ä»·æ ¼å¤±è´¥ï¼Œè¯·é‡è¯•'ï¼Œ 'error');
                elements.swapButton.textContent = 'äº¤æ¢';
                elements.swapButton.disabled = !state.walletConnected;
            }
        }

        // æ‰§è¡Œäº¤æ¢
        async function executeSwap() {
            if (!state.walletConnected) {
                showNotification('è¯·å…ˆè¿æ¥é’±åŒ…'ï¼Œ 'error');
                return;
            }
            
            if (!state.amount || state.amount <= 0) {
                showNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„äº¤æ¢é‡‘é¢'ï¼Œ 'error');
                return;
            }
            
            try {
                elementsã€‚swapButtonã€‚innerHTML = '<div class="loading"></div> å¤„ç†ä¸­...';
                elementsã€‚swapButtonã€‚disabled = true;
                
                // è¿™é‡Œåº”è¯¥æ˜¯çœŸå®çš„äº¤æ˜“å¤„ç†
                // 1. æ£€æŸ¥æˆæƒ
                // 2. å¦‚æœéœ€è¦ï¼Œè¿›è¡Œä»£å¸æˆæƒ
                // 3. æ‰§è¡Œäº¤æ¢äº¤æ˜“
                
                // æ¨¡æ‹Ÿäº¤æ˜“å¤„ç†
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                showNotification('äº¤æ¢æˆåŠŸå®Œæˆ', 'success');
                
            } catch (error) {
                consoleã€‚error('äº¤æ¢å¤±è´¥:'ï¼Œ error);
                showNotification('äº¤æ¢å¤±è´¥: ' + error.messageï¼Œ 'error');
            } finally {
                elements.swapButton.textContent = 'äº¤æ¢';
                elementsã€‚swapButtonã€‚disabled = !stateã€‚walletConnected;
            }
        }

        // æ›´æ–°é’±åŒ…ä½™é¢
        async function updateWalletBalance() {
            if (!state.walletAddress || !state.provider) return;
            
            try {
                const balance = await state.provider.getBalance(state.walletAddress);
                stateã€‚walletBalance = parseFloat(ethersã€‚utilsã€‚formatEther(balance));
                
                // æ›´æ–°ä»£å¸ä½™é¢æ˜¾ç¤º
                if (state.fromToken.address === '0x0000000000000000000000000000000000000000') {
                    stateã€‚fromTokenã€‚balance = stateã€‚walletBalance;
                    elementsã€‚fromBalanceã€‚textContent = state.walletBalance.toFixed(4);
                }
            } catch (error) {
                console.error('è·å–ä½™é¢å¤±è´¥:', error);
            }
        }

        // [æ­¤å¤„çœç•¥å…¶ä»–è¾…åŠ©å‡½æ•°ï¼Œä¿æŒä¸ä¹‹å‰ç›¸åŒ]

        // åˆå§‹åŒ–åº”ç”¨
        init();
    </script>
</body>
</html>
